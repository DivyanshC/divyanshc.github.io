<!DOCTYPE html><html lang="en" data-mode="dark" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.2.2" /><meta property="og:title" content="Connecting services to internet using reverse proxy" /><meta property="og:locale" content="en" /><meta name="description" content="Exposing your services to the internet using SSL" /><meta property="og:description" content="Exposing your services to the internet using SSL" /><link rel="canonical" href="https://docs.divyanshchauhan.com/posts/connect-services-to-internet/" /><meta property="og:url" content="https://docs.divyanshchauhan.com/posts/connect-services-to-internet/" /><meta property="og:site_name" content="HomeLab Docs" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2022-06-04T16:33:00+05:30" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Connecting services to internet using reverse proxy" /><meta name="twitter:site" content="@twitter_username" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2022-06-18T18:37:12+05:30","datePublished":"2022-06-04T16:33:00+05:30","description":"Exposing your services to the internet using SSL","headline":"Connecting services to internet using reverse proxy","mainEntityOfPage":{"@type":"WebPage","@id":"https://docs.divyanshchauhan.com/posts/connect-services-to-internet/"},"url":"https://docs.divyanshchauhan.com/posts/connect-services-to-internet/"}</script><title>Connecting services to internet using reverse proxy | HomeLab Docs</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="HomeLab Docs"><meta name="application-name" content="HomeLab Docs"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src=" https://scontent.fjai2-3.fna.fbcdn.net/v/t1.18169-9/11694969_419709824894833_3925710887049227214_n.jpg?_nc_cat=100&ccb=1-7&_nc_sid=09cbfe&_nc_ohc=ErsXOWJtPgMAX-wlBrf&_nc_ht=scontent.fjai2-3.fna&oh=00_AT_dJW3f4LxFkaU2X9n37ie4J9K0N7KCa0LGw5sbAqTILw&oe=632FB713 " alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">HomeLab Docs</a></div><div class="site-subtitle font-italic">A Doc site for my homelab</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <a href="https://github.com/divyanshc" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="https://twitter.com/twitter_username" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['hello','divyanshchauhan.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>Connecting services to internet using reverse proxy</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>Connecting services to internet using reverse proxy</h1><div class="post-meta text-muted"><div> By <em> <a href="https://github.com/divyanshc">Divyansh Chauhan</a> </em></div><div class="d-flex"><div> <span> Posted <em class="timeago" data-ts="1654340580" data-toggle="tooltip" data-placement="bottom" data-tooltip-df="llll" > 2022-06-04 </em> </span> <span> Updated <em class="timeago" data-ts="1655557632" data-toggle="tooltip" data-placement="bottom" data-tooltip-df="llll" > 2022-06-18 </em> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="3192 words"> <em>17 min</em> read</span></div></div></div><div class="post-content"><h1 id="exposing-your-services-to-the-internet-using-ssl">Exposing your services to the internet using SSL</h1><p>We have a domain but the <strong>tricky</strong> part is how to <strong>connect</strong> that domain to our service.</p><p>Here comes the part of <strong>reverse proxy</strong> and <strong>cloudflare tunnel</strong>.</p><p>We have different <strong>services</strong> running at different ports and we want to expose them to the internet on different apex domains and sub domains.</p><h3 id="dns-entry"><span class="mr-2"><u>DNS Entry</u></span><a href="#dns-entry" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><p>You will have to <strong>point</strong> your domain or subdomain on your DNS to the server on which you will run your services using reverse proxy. No need to do this if you are using a <strong>cloudflare tunnel</strong>.</p><p>Add a DNS <strong>A</strong> record for the apex domain and point it to your server’s IP address.</p><p>If your apex domain point to a server, you also want your subdomain to point to that same server then add a <strong>CNAME</strong> record for the subdomain and point it to the apex domain.</p><h1 id="1-cloudflare-tunnel">1. Cloudflare Tunnel</h1><p>It is the easiest of them all.</p><p>There is no need to open any ports or do any port forwarding for the router.</p><ul><li><p>Go to Cloudflare <a href="https://dash.cloudflare.com/">dashboard</a></p><li><p>Select your domain &gt; click on access tab and then click on <a href="https://dash.teams.cloudflare.com/"><strong>Launch Zero Trust</strong></a>.</p><li><p>This will open a zero trust dashboard, then got to Access &gt; Tunnels &gt; Create a tunnel.</p><li><p>Give you tunnel a name then click on next, choose your <strong>os</strong> environment then appropriately install cloudflared <strong>connector</strong> and click on next. (Do not install docker for <strong>arm64</strong>)</p><li><p>Click on Add a public hostname,then provide your subdomain name, select your subdomain.</p><li><p>In service section, select http if service don’t have SSL certificate, then enter **localhost:<PORT_NUMBER>** of your application. Then click on save hostname. (You can add multiple hostnames for different services).</PORT_NUMBER></p><li><p>It will add <strong>subdomain</strong> to your <strong>DNS</strong> automatically.</p></ul><h3 id="check-if-cloudflared-service-running--"><span class="mr-2"><u>Check if cloudflared service running : </u></span><a href="#check-if-cloudflared-service-running--" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><p>Run the following command in your terminal.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nb">sudo </span>systemctl status cloudflared
</pre></table></code></div></div><p>If not running then run the following command in your terminal.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nb">sudo </span>systemctl start cloudflared
</pre></table></code></div></div><p>Check if service is enabled for running on boot.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nb">sudo </span>systemctl is-enabled cloudflared
</pre></table></code></div></div><p>If not enabled then run the following command in your terminal.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nb">sudo </span>systemctl <span class="nb">enable </span>cloudflared
</pre></table></code></div></div><p>Try restarting the service</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nb">sudo </span>systemctl restart cloudflared
</pre></table></code></div></div><p>If it does not start then we have create a cert.pem file which is the origincert flag file.</p><h2 id="there-are-two-ways-to-create-a-certpem-file-"><span class="mr-2">There are two ways to create a cert.pem file :</span><a href="#there-are-two-ways-to-create-a-certpem-file-" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><h3 id="1-through-terminal"><span class="mr-2">1. Through Terminal</span><a href="#1-through-terminal" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><p>Type the following command in your terminal.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>cloudflared tunnel login
</pre></table></code></div></div><p>It will open a browser window showing <strong>Authorize Cloudflare Tunnel</strong>.</p><p>Click on your domain name and then click on <strong>Authorize</strong>.</p><p>It will automatically add a cert.pem file in your /home/&lt;USER&gt;/.cloudflared/ directory.</p><p>Then try restarting the cloudflared service again.</p><h3 id="2-through-browser-and-downloading-the-certpem-file"><span class="mr-2">2. Through Browser and downloading the cert.pem file</span><a href="#2-through-browser-and-downloading-the-certpem-file" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><p>Open this <a href="https://dash.cloudflare.com/argotunnel">Argo Tunnel link</a> &gt; Select your domain &gt; Authorize &gt; Download the certificate.</p><p>Then copy the cert.pem file to your <strong>/etc/cloudflared</strong> directory.</p><p>Then try restarting the cloudflared service again.</p><h1 id="2-reverse-proxy-manager">2. Reverse Proxy Manager</h1><p>There are many reverse proxy managers available like <strong>caddy</strong>, <strong>nginx proxy manager</strong>, <strong>traefik</strong> etc.</p><p>For this you will need your domain or subdomain to point to your server’s IP address. See this <a href="#dns-entry">DNS Entry section</a>.</p><p>Respective ports should be opened and port forwarding has to be done for the router.</p><h2 id="1-caddy"><span class="mr-2">1. Caddy</span><a href="#1-caddy" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><ul><li><p>Open the installation page <a href="https://caddyserver.com/docs/install">here</a>. If you want to install on the host machine. We will use docker for this.</p><li><p>Use <em>docker-compose.yml</em> as mentioned below. (Make a directory named caddy and copy the file to that directory)</p></ul><div class="language-yaml highlighter-rouge"><div class="code-header"> <span data-label-text="YAML"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre><td class="rouge-code"><pre><span class="na">version</span><span class="pi">:</span> <span class="s2">"</span><span class="s">3.7"</span>

<span class="na">services</span><span class="pi">:</span>
  <span class="na">caddy</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">caddy:latest</span>
    <span class="na">container_name</span><span class="pi">:</span> <span class="s">caddy</span>
    <span class="na">restart</span><span class="pi">:</span> <span class="s">unless-stopped</span>
    <span class="na">ports</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">80:80"</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">443:443"</span>
    <span class="na">volumes</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">./Caddyfile:/etc/caddy/Caddyfile</span>
      <span class="c1"># - $PWD/site:/srv</span>
      <span class="pi">-</span> <span class="s">./caddy_data:/data</span>
      <span class="pi">-</span> <span class="s">./caddy_config:/config</span>
      <span class="pi">-</span> <span class="s">./certs:/etc/certs/origin_cloudflare</span>
</pre></table></code></div></div><p>It’s very simple with caddy just add the following to your <strong>Caddyfile</strong>.</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre>#{
#	acme_ca https://acme-staging-v02.api.letsencrypt.org/directory
#}

caddy.example.com {
	#tls /etc/certs/origin_cloudflare/ssl_origin_certificate.cert /etc/certs/origin_cloudflare/ssl_origin_certificate_key.pem
	reverse_proxy nginx:80
}
</pre></table></code></div></div><ul><li><p>Run command in your terminal to run the caddy docker.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>docker-compose up <span class="nt">-d</span> <span class="nt">--force-recreate</span>
</pre></table></code></div></div><li><p>We will use <strong>nginx</strong> as an example here. First we will create a nginx docker.</p></ul><div class="language-yaml highlighter-rouge"><div class="code-header"> <span data-label-text="YAML"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre><td class="rouge-code"><pre><span class="na">version</span><span class="pi">:</span> <span class="s2">"</span><span class="s">3"</span>

<span class="na">services</span><span class="pi">:</span>
  <span class="na">nginx</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">nginx:latest</span>
    <span class="na">container_name</span><span class="pi">:</span> <span class="s">nginx</span>
    <span class="na">restart</span><span class="pi">:</span> <span class="s">unless-stopped</span>
    <span class="c1"># ports:</span>
    <span class="c1">#   - "1080:80"</span>
    <span class="na">networks</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">caddy_default</span>

<span class="na">networks</span><span class="pi">:</span>
  <span class="na">caddy_default</span><span class="pi">:</span>
    <span class="na">external</span><span class="pi">:</span> <span class="s">True</span>
</pre></table></code></div></div><ul><li><p>Don’t use <strong>proxy</strong> when adding <strong>DNS record</strong> to <strong>cloudflare</strong> when first getting <strong>letsenrypt</strong> certificate. (It needs to check if domain is <em>pointing</em> to the server ip or not, You can after certificate is obtained)</p><li><p>Caddy will <strong>automatically</strong> generate a SSL certificate for you from the <strong>Let’s Encrypt</strong> server. (Make sure you have ports 80 and 443 open in your firewall or your server vnc because by default it uses http challenge to get the certificate.)</p><li><p>First try with <strong>staging SSL</strong> certificate by using the following command at the top of caddyfile. If everything work fine then comment out the following line as showing in our caddyfile. (We are using staging SSL certificate here because there is a <em>rate limit</em> for <em>production SSL</em> certificate.)</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>{
  acme_ca https://acme-staging-v02.api.letsencrypt.org/directory
}
</pre></table></code></div></div><li><p>If you want to use <strong>custom SSL</strong> certificate then use the following line.</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>tls /etc/certs/origin_cloudflare/ssl_origin_certificate.cert /etc/certs/origin_cloudflare/ssl_origin_certificate_key.pem
</pre></table></code></div></div><li><p>To get <em>custom</em> certificates from cloudflare check <a href="#2-through-cloudflare">this</a></p></ul><h2 id="2-installing-nginx-proxy-manager"><span class="mr-2">2. Installing Nginx Proxy Manager</span><a href="#2-installing-nginx-proxy-manager" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><ul><li><p>Open the <a href="https://nginxproxymanager.com/guide/"> installation guide</a>.</p><li><p>Use <em>docker-compose.yml</em> as mentioned below. (Make a directory named nginx_proxy_manager and copy the file to that directory)</p></ul><div class="language-yaml highlighter-rouge"><div class="code-header"> <span data-label-text="YAML"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre><td class="rouge-code"><pre><span class="na">version</span><span class="pi">:</span> <span class="s2">"</span><span class="s">3"</span>
<span class="na">services</span><span class="pi">:</span>
  <span class="na">app</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s2">"</span><span class="s">jc21/nginx-proxy-manager:latest"</span>
    <span class="na">container_name</span><span class="pi">:</span> <span class="s2">"</span><span class="s">nginx-proxy-manager"</span>
    <span class="na">restart</span><span class="pi">:</span> <span class="s">unless-stopped</span>
    <span class="na">ports</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">80:80"</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">81:81"</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">443:443"</span>
    <span class="na">volumes</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">./data:/data</span>
      <span class="pi">-</span> <span class="s">./letsencrypt:/etc/letsencrypt</span>
    <span class="na">networks</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">npm</span>

<span class="na">networks</span><span class="pi">:</span>
  <span class="na">npm</span><span class="pi">:</span>
</pre></table></code></div></div><p>Now run the following command in your terminal.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>docker-compose up <span class="nt">-d</span>
</pre></table></code></div></div><p>Then check if docker created our network.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>docker network list
</pre></table></code></div></div><p>It will show the network name as <strong>&lt;FOLDER_NAME&gt;_npm</strong>.</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>name : nginx_proxy_manager_npm
driver : bridge
scope : local
</pre></table></code></div></div><p>Now for example lets say you want to host vaultwarden on port 8080.</p><p>Use the docker network command as follows in docker-compose.yml file of that service. See the networks part.</p><div class="language-yml highlighter-rouge"><div class="code-header"> <span data-label-text="YAML"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre><td class="rouge-code"><pre><span class="na">version</span><span class="pi">:</span> <span class="s2">"</span><span class="s">3"</span>
<span class="na">services</span><span class="pi">:</span>
  <span class="na">vaultwarden</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">vaultwarden/server:latest</span>
    <span class="na">container_name</span><span class="pi">:</span> <span class="s">vaultwarden</span>
    <span class="na">networks</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">nginx_proxy_manager_npm</span>
    <span class="na">volumes</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">./data:/data/</span>
    <span class="na">ports</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">8080:80</span>
    <span class="na">restart</span><span class="pi">:</span> <span class="s">unless-stopped</span>

<span class="na">networks</span><span class="pi">:</span>
  <span class="na">nginx_proxy_manager_npm</span><span class="pi">:</span>
    <span class="na">external</span><span class="pi">:</span> <span class="no">true</span>
</pre></table></code></div></div><p>Here <strong>external flag</strong> is used to connect to a network which is already created.</p><p>Now go to the <strong>http://&lt;localhost_or_your_ip&gt;:81</strong> for nginx proxy manager dashboard.</p><h2 id="adding-ssl-certificate"><span class="mr-2"><u>Adding SSL Certificate</u></span><a href="#adding-ssl-certificate" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><ul><li>Got to SSL Certificates tab. Then click on <strong>Add SSL Certificate</strong>.</ul><p>There are two ways to get SSL certificate :</p><h3 id="1-through-letsencrypt"><span class="mr-2">1. <u>Through Letsencrypt</u></span><a href="#1-through-letsencrypt" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><ul><li><p>Enter the <strong>apex</strong> domain, <strong>wildcard</strong> subdomain name in the <strong>Domain Names</strong> field. (eg. <strong>example.com</strong>, <strong>*.example.com</strong>)</p><li><p>Enter any email address from which you want to receive the certificate.</p><li><p>Check on DNS Challenge checkbox. Choose DNS provider as cloudflare. (You have to use DNS challenge if you want wildcard subdomain.)</p></ul><p>It will show Credentials file content field.</p><p>You want an API token from cloudflare:</p><ul><li><p>Go to <a href="https://dash.cloudflare.com/">cloudflare dashboard</a> &gt; Overview &gt; Get your API token (bottom right hand side).</p><li><p>Click on create token &gt;use template of edit zone DNS &gt; Under zone resources change specific zone to all zones &gt; click on continue to summary &gt; click on create token.</p><li><p>Copy the token and save it (it will not be shown later or just create a new one if lost).</p><li><p>Copy this edit zone dns api token here as shown below:</p></ul><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre># Cloudflare API token
dns_cloudflare_api_token = &lt;ADD_YOUR_API_TOKEN&gt;
</pre></table></code></div></div><ul><li>Click on I Agree then Save. It will take some time to generate the certificate.</ul><p>This certificate will only last upto 3 months then we have to renew it.</p><h3 id="2-through-cloudflare"><span class="mr-2">2. <u>Through Cloudflare</u></span><a href="#2-through-cloudflare" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><ul><li><p>Go to <a href="https://dash.cloudflare.com/">cloudflare dashboard</a> &gt; SSL/TLS &gt; Origin Server &gt; Create Certificate.</p><li><p>Select 15 years for certificate validity &gt; Create.</p><li><p>Save <strong>Origin Certificate</strong> as <em>&lt;filename&gt;.pem</em> and <strong>Private Key</strong> as <em>&lt;filename&gt;.key</em></p><li><p>Now go to nginx proxy manager dashboard and click on <strong>SSL Certificates</strong> &gt; Add SSL Certificate &gt; Custom.</p><li><p>Give any name, <strong>certificate key</strong> will be <em>&lt;filename&gt;.key</em> and <strong>certificate</strong> will be <em>&lt;filename&gt;.pem</em> &gt; Click on Save. It will take some time to generate the certificate.</p></ul><h3 id="adding-a-service-to-a-domain-or-subdomain"><span class="mr-2"><u>Adding a service to a domain or subdomain</u></span><a href="#adding-a-service-to-a-domain-or-subdomain" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><ul><li><p>Go to nginx proxy manager dashboard &gt; Hosts &gt; Proxy Hosts &gt; Add proxy host.</p><li><p>Under domain names enter the domain name or subdomain name.</p><li><p>Select http.</p><li><p>Hostname/IP will be <strong>name of our docker container</strong> which is on the same network as nginx proxy manager or IP of your server when not running in docker. (You can also provide IP of your docker container but it will change after every restart.)</p></ul><p>To Check IP of your docker container use the following command in your terminal :</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>docker inspect &lt;CONTAINER_NAME_OR_ID&gt; | <span class="nb">grep</span> <span class="s1">'"IPAddress"'</span> | <span class="nb">tail</span> <span class="nt">-n1</span>
</pre></table></code></div></div><ul><li><p>Port will be the <strong>internal</strong> port of the service which is running in docker (8080:80 then <strong>80</strong>) or the service port when not running in docker.</p><li><p>Tick all the checkboxes &gt; Got to SSL Certificates &gt; Select the appropriate certificate &gt; Tick all the checkboxes &gt; Click on Save.</p></ul><h2 id="3-installing-traefik"><span class="mr-2">3. Installing Traefik</span><a href="#3-installing-traefik" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>This one is bit complicated because Traefik allows various implementations of configuration.</p><p>First create a traefik folder in which we will install traefik.</p><p>The overall file structure is as follows.</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre><td class="rouge-code"><pre>traefik/
├── docker-compose.yml
└── etc
    └── traefik
        ├── certs
        │   ├── acme.json
        │   ├── cert-key.pem
        │   └── cert.cert
        ├── config.yml
        └── traefik.yml

3 directories, 6 files
</pre></table></code></div></div><p>Then create a docker-compose.yml file in that folder.</p><div class="language-yaml highlighter-rouge"><div class="code-header"> <span data-label-text="YAML"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
</pre><td class="rouge-code"><pre><span class="na">version</span><span class="pi">:</span> <span class="s2">"</span><span class="s">3"</span>

<span class="na">services</span><span class="pi">:</span>
  <span class="na">traefik</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s2">"</span><span class="s">traefik:latest"</span>
    <span class="na">container_name</span><span class="pi">:</span> <span class="s2">"</span><span class="s">traefik"</span>
    <span class="na">restart</span><span class="pi">:</span> <span class="s2">"</span><span class="s">unless-stopped"</span>
    <span class="na">environment</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">TZ=Asia/Kolkata</span>
      <span class="c1"># - CF_API_EMAIL=your_cloudflare_email</span>
      <span class="c1"># - CF_DNS_API_TOKEN=your_cloudflare_api_token</span>
      <span class="c1"># - CF_API_KEY=YOU_API_KEY</span>
      <span class="c1"># be sure to use the correct one depending on if you are using a token or key</span>
    <span class="na">ports</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">80:80"</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">443:443"</span>
      <span class="c1"># (Optional) Expose Dashboard</span>
      <span class="c1"># - "8082:8080"  # Don't do this in production!</span>
    <span class="na">volumes</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">./etc/traefik:/etc/traefik</span>
      <span class="pi">-</span> <span class="s">/var/run/docker.sock:/var/run/docker.sock:ro</span>
      <span class="pi">-</span> <span class="s">traefik-logs:/var/log/traefik</span>
    <span class="na">labels</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">traefik.enable=true"</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">traefik.http.routers.traefik.entrypoints=websecure"</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">traefik.http.routers.traefik.rule=Host(`traefik.example.com`)"</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">traefik.http.middlewares.traefik-auth.basicauth.users=USER:BASIC_AUTH_PASSWORD"</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">traefik.http.routers.traefik.middlewares=traefik-auth"</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">traefik.http.routers.traefik.tls=true"</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">traefik.http.services.traefik.loadbalancer.server.port=8080"</span>

      <span class="c1"># - "traefik.http.routers.traefik-secure.tls=true"</span>
      <span class="c1"># - "traefik.http.routers.traefik-secure.tls.certresolver=cloudflare"</span>
      <span class="c1"># - "traefik.http.routers.traefik-secure.tls.domains[0].main=example.com"</span>
      <span class="c1"># - "traefik.http.routers.traefik-secure.tls.domains[0].sans=*.example.com"</span>
      <span class="c1"># - "traefik.http.routers.traefik-secure.service=api@internal"</span>

<span class="na">volumes</span><span class="pi">:</span>
  <span class="na">traefik-logs</span><span class="pi">:</span>
</pre></table></code></div></div><p>Adding authentication for the traefik dashboard in above yml.</p><ol><li>Install :</ol><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="nb">sudo </span>apt update
<span class="nb">sudo </span>apt <span class="nb">install </span>apache2-utils
</pre></table></code></div></div><ol><li>Create a user:password for the dashboard.</ol><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nb">echo</span> <span class="si">$(</span>htpasswd <span class="nt">-nb</span> &lt;USER&gt; &lt;PASSWORD&gt;<span class="si">)</span> | <span class="nb">sed</span> <span class="nt">-e</span> s/<span class="se">\\</span><span class="nv">$/</span><span class="se">\\</span><span class="nv">$\</span><span class="se">\$</span>/g
</pre></table></code></div></div><p>Here <USER> is the username and <PASSWORD> is the password.</PASSWORD></USER></p><p>Replace <strong>USER:BASIC_AUTH_PASSWORD</strong> with the generated string.</p><p>If you want letsenrypt SSL certificates then you can use appropriate certresolver.</p><p>I am using cloudflare as my DNS provider.</p><p>Then create etc &gt; traefik folder in traefik folder.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nb">mkdir</span> <span class="nt">-p</span> etc/traefik
</pre></table></code></div></div><p>Then create a traefik.yml file in /traefik/etc/traefik folder.</p><p>This is a <strong>static configuration</strong> for traefik. It will use this at the start of traefik container.</p><div class="language-yaml highlighter-rouge"><div class="code-header"> <span data-label-text="YAML"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
</pre><td class="rouge-code"><pre><span class="na">global</span><span class="pi">:</span>
  <span class="na">checkNewVersion</span><span class="pi">:</span> <span class="no">true</span>
  <span class="na">sendAnonymousUsage</span><span class="pi">:</span> <span class="no">false</span> <span class="c1"># true by default</span>

<span class="c1"># (Optional) Log information</span>
<span class="c1"># ---</span>
<span class="c1"># log:</span>
<span class="c1">#   level: DEBUG # DEBUG, INFO, WARNING, ERROR, CRITICAL</span>
<span class="c1">#   format: common  # common, json, logfmt</span>
<span class="c1">#   filePath: /var/log/traefik/traefik.log</span>

<span class="c1"># (Optional) Accesslog</span>
<span class="c1"># ---</span>
<span class="c1"># accesslog:</span>
<span class="c1"># format: common  # common, json, logfmt</span>
<span class="c1"># filePath: /var/log/traefik/access.log</span>

<span class="c1"># (Optional) Enable API and Dashboard</span>
<span class="c1"># ---</span>
<span class="na">api</span><span class="pi">:</span>
  <span class="na">dashboard</span><span class="pi">:</span> <span class="no">true</span> <span class="c1"># true by default</span>
  <span class="na">insecure</span><span class="pi">:</span> <span class="no">true</span> <span class="c1"># Don't do this in production!</span>

<span class="c1"># Entry Points configuration</span>
<span class="c1"># ---</span>
<span class="na">entryPoints</span><span class="pi">:</span>
  <span class="na">web</span><span class="pi">:</span>
    <span class="na">address</span><span class="pi">:</span> <span class="s">:80</span>
    <span class="c1"># (Optional) Redirect to HTTPS</span>
    <span class="c1"># ---</span>
    <span class="na">http</span><span class="pi">:</span>
      <span class="na">middlewares</span><span class="pi">:</span> <span class="c1"># middleware that works for every request</span>
        <span class="pi">-</span> <span class="s">services-ratelimit@file</span>
      <span class="na">redirections</span><span class="pi">:</span>
        <span class="na">entryPoint</span><span class="pi">:</span>
          <span class="na">to</span><span class="pi">:</span> <span class="s">websecure</span>
          <span class="na">scheme</span><span class="pi">:</span> <span class="s">https</span>

  <span class="na">websecure</span><span class="pi">:</span>
    <span class="na">address</span><span class="pi">:</span> <span class="s">:443</span>
    <span class="na">http</span><span class="pi">:</span>
      <span class="na">middlewares</span><span class="pi">:</span> <span class="c1"># middleware that works for every request</span>
        <span class="pi">-</span> <span class="s">services-ratelimit@file</span>

<span class="c1"># Configure your CertificateResolver here...</span>
<span class="c1"># ---</span>
<span class="na">certificatesResolvers</span><span class="pi">:</span> <span class="c1"># Don't use proxy when adding DNS record to cloudflare when first getting letsenrypt certificate (You can after certificate is obtained)</span>
<span class="na">staging</span><span class="pi">:</span> <span class="c1"># Open ports 80 and 443 in firewall</span>
  <span class="na">acme</span><span class="pi">:</span>
    <span class="na">email</span><span class="pi">:</span> <span class="s">your_email_address_for_letsencrypt</span>
    <span class="na">storage</span><span class="pi">:</span> <span class="s">/etc/traefik/certs/acme.json</span>
    <span class="na">caServer</span><span class="pi">:</span> <span class="s2">"</span><span class="s">https://acme-staging-v02.api.letsencrypt.org/directory"</span>
    <span class="na">httpChallenge</span><span class="pi">:</span>
      <span class="na">entryPoint</span><span class="pi">:</span> <span class="s">web</span>

<span class="na">production</span><span class="pi">:</span> <span class="c1"># Open ports 80 and 443 in firewall</span>
  <span class="na">acme</span><span class="pi">:</span>
    <span class="na">email</span><span class="pi">:</span> <span class="s">your_email_address_for_letsencrypt</span>
    <span class="na">storage</span><span class="pi">:</span> <span class="s">/etc/traefik/certs/acme.json</span>
    <span class="na">caServer</span><span class="pi">:</span> <span class="s2">"</span><span class="s">https://acme-v02.api.letsencrypt.org/directory"</span>
    <span class="na">httpChallenge</span><span class="pi">:</span>
      <span class="na">entryPoint</span><span class="pi">:</span> <span class="s">web</span>

<span class="na">cloudflare</span><span class="pi">:</span> <span class="c1"># Open ports 80 and 443 in firewall</span>
  <span class="na">acme</span><span class="pi">:</span>
    <span class="na">email</span><span class="pi">:</span> <span class="s">your_email_address_for_letsencrypt</span>
    <span class="na">storage</span><span class="pi">:</span> <span class="s">/etc/traefik/certs/acme.json</span>
    <span class="na">dnsChallenge</span><span class="pi">:</span>
      <span class="na">provider</span><span class="pi">:</span> <span class="s">cloudflare</span>
      <span class="na">resolvers</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="s2">"</span><span class="s">1.1.1.1:53"</span>
        <span class="pi">-</span> <span class="s2">"</span><span class="s">1.0.0.1:53"</span>

<span class="c1"># (Optional) Overwrite Default Certificates</span>
<span class="na">tls</span><span class="pi">:</span>
  <span class="na">stores</span><span class="pi">:</span>
    <span class="na">default</span><span class="pi">:</span>
      <span class="na">defaultCertificate</span><span class="pi">:</span>
        <span class="na">certFile</span><span class="pi">:</span> <span class="s">/etc/traefik/certs/cert.cert</span>
        <span class="na">keyFile</span><span class="pi">:</span> <span class="s">/etc/traefik/certs/cert-key.pem</span>
  <span class="c1"># (Optional) Disable TLS version 1.0 and 1.1</span>
  <span class="na">options</span><span class="pi">:</span>
    <span class="na">default</span><span class="pi">:</span>
      <span class="na">minVersion</span><span class="pi">:</span> <span class="s">VersionTLS12</span>

<span class="na">providers</span><span class="pi">:</span>
  <span class="na">docker</span><span class="pi">:</span>
    <span class="na">exposedByDefault</span><span class="pi">:</span> <span class="no">false</span> <span class="c1"># Default is true</span>
  <span class="na">file</span><span class="pi">:</span>
    <span class="c1"># watch for dynamic configuration changes</span>
    <span class="na">directory</span><span class="pi">:</span> <span class="s">/etc/traefik</span>
    <span class="na">watch</span><span class="pi">:</span> <span class="no">true</span>
    <span class="c1"># filename: /etc/traefik/config.yml</span>

<span class="na">log</span><span class="pi">:</span>
  <span class="na">level</span><span class="pi">:</span> <span class="s2">"</span><span class="s">INFO"</span>
  <span class="na">filePath</span><span class="pi">:</span> <span class="s2">"</span><span class="s">/var/log/traefik/traefik.log"</span>
<span class="na">accessLog</span><span class="pi">:</span>
  <span class="na">filePath</span><span class="pi">:</span> <span class="s2">"</span><span class="s">/var/log/traefik/access.log"</span>
</pre></table></code></div></div><p>If you want any <strong>dynamic configuration</strong> then add a <em>config.yml</em> file in /traefik/etc/traefik folder. This is used for any other networking services that we need. (Also to communicate with services that don’t use docker cotainer.)</p><p>This is an example of <em>config.yml</em> file. Traefik will watch for changes in this file and reload the configuration. This file is not necessary.</p><div class="language-yaml highlighter-rouge"><div class="code-header"> <span data-label-text="YAML"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
</pre><td class="rouge-code"><pre><span class="c1"># http routing section</span>
<span class="na">http</span><span class="pi">:</span>
  <span class="na">routers</span><span class="pi">:</span>
    <span class="c1"># Define a connection between requests and services</span>
    <span class="na">to-whoami</span><span class="pi">:</span>
      <span class="na">entryPoints</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="s2">"</span><span class="s">websecure"</span>
      <span class="na">rule</span><span class="pi">:</span> <span class="s2">"</span><span class="s">Host(`example.com`)</span><span class="nv"> </span><span class="s">&amp;&amp;</span><span class="nv"> </span><span class="s">PathPrefix(`/whoami/`)"</span>
      <span class="c1"># If the rule matches, applies the middleware</span>
      <span class="na">middlewares</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="s">services-user</span>
      <span class="na">tls</span><span class="pi">:</span> <span class="pi">{}</span> <span class="c1"># SSL termination configuration leave empty to send this service request to http endpoint</span>
      <span class="c1"># If the rule matches, forward to the whoami service (declared below)</span>
      <span class="na">service</span><span class="pi">:</span> <span class="s">whoami</span>

  <span class="na">services</span><span class="pi">:</span>
    <span class="c1"># Define how to reach an existing service on our infrastructure</span>
    <span class="na">whoami</span><span class="pi">:</span>
      <span class="na">loadBalancer</span><span class="pi">:</span>
        <span class="na">servers</span><span class="pi">:</span> <span class="c1"># use host.docker.internal instead of &lt;private-ip&gt; for accessing the service from the host machine</span>
          <span class="pi">-</span> <span class="na">url</span><span class="pi">:</span> <span class="s">http://&lt;private-ip&gt;:8000</span>

  <span class="na">middlewares</span><span class="pi">:</span>
    <span class="c1"># Here, an average of 100 requests per second is allowed.</span>
    <span class="c1"># In addition, a burst of 50 requests is allowed.</span>
    <span class="na">services-ratelimit</span><span class="pi">:</span>
      <span class="na">rateLimit</span><span class="pi">:</span>
        <span class="na">average</span><span class="pi">:</span> <span class="m">100</span>
        <span class="na">burst</span><span class="pi">:</span> <span class="m">50</span>

    <span class="c1"># Define an authentication mechanism</span>
    <span class="na">services-user</span><span class="pi">:</span>
      <span class="na">basicAuth</span><span class="pi">:</span>
        <span class="na">users</span><span class="pi">:</span> <span class="c1"># Replace **USER:BASIC_AUTH_PASSWORD** with the generated string</span>
          <span class="pi">-</span> <span class="s">USER:$apr1$H6uskkkW$IgXLP6ewTrSuBkTrqE8wj/</span>
</pre></table></code></div></div><p>Now add a certs folder in this /traefik/etc/traefik folder.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nb">mkdir </span>certs
</pre></table></code></div></div><p>Then create acme.json file. It has to be created for traefik to run. It will be used by traefik to store certificates as shown in yml.</p><div class="language-yaml highlighter-rouge"><div class="code-header"> <span data-label-text="YAML"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="pi">{</span>
  <span class="s2">"</span><span class="s">email"</span><span class="pi">:</span> <span class="s2">"</span><span class="s">your_email_address_for_letsencrypt"</span><span class="pi">,</span>
  <span class="s2">"</span><span class="s">storage"</span><span class="pi">:</span> <span class="s2">"</span><span class="s">/etc/traefik/certs/acme.json"</span><span class="pi">,</span>
<span class="pi">}</span>
</pre></table></code></div></div><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="nb">touch </span>acme.json
<span class="nb">chmod </span>600 acme.json
</pre></table></code></div></div><ul><li><p>Don’t use <strong>proxy</strong> when adding <strong>DNS record</strong> to <strong>cloudflare</strong> when first getting <strong>letsenrypt</strong> certificate. (It needs to check if domain is <em>pointing</em> to the server ip or not, You can after certificate is obtained)</p><li><p>If you want to use <strong>letsencrypt SSL</strong> certificates then you can use the appropriate certresolver as <em>staging</em> or <em>production</em>. (These will be stored in acme.json, if using staging as your certresolver then <strong>delete</strong> all contents of <em>acme.json</em> file first then use production certresolver.)</p><li><p>If you want to use custom certificates then add the following lines in config.yml file.</p></ul><div class="language-yaml highlighter-rouge"><div class="code-header"> <span data-label-text="YAML"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="c1"># Standalone TLS configuration (do not paste this under any section)</span>
<span class="na">tls</span><span class="pi">:</span> <span class="c1"># Use this for custom SSL certs other than default one set in traefik.yml</span>
  <span class="na">certificates</span><span class="pi">:</span> <span class="c1"># traefik will match your domain name with the certificate name (without .com)</span>
    <span class="pi">-</span> <span class="na">certFile</span><span class="pi">:</span> <span class="s">/path/to/other-domain-name.cert</span>
      <span class="na">keyFile</span><span class="pi">:</span> <span class="s">/path/to/other-domain-name.key</span>
</pre></table></code></div></div><ul><li><p>If you have obtained your coudflare SSL certificates then you can store them in the certs folder. For more info to get your cloudflare SSL certificates read this <a href="#2-through-cloudflare">cloudflare ssl certificate</a>.</p><li><code class="language-plaintext highlighter-rouge">cert.cert</code>: contains the certificate<li><code class="language-plaintext highlighter-rouge">cert-key.pem</code>: contains the private key</ul><p>Then start your traefik container by running the following command by going to the /traefik folder where docker compose file is added.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>docker-compose up <span class="nt">-d</span> <span class="nt">--force-recreate</span>
</pre></table></code></div></div><h3 id="example-of-a-docker-container-using-traefik"><span class="mr-2">Example of a docker container using traefik.</span><a href="#example-of-a-docker-container-using-traefik" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><p>We will use nginx as our example container.</p><p>First create a new folder named nginx on your machine. Then add docker-compose.yml file in this folder.</p><div class="language-yaml highlighter-rouge"><div class="code-header"> <span data-label-text="YAML"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
</pre><td class="rouge-code"><pre><span class="na">version</span><span class="pi">:</span> <span class="s2">"</span><span class="s">3"</span>

<span class="na">services</span><span class="pi">:</span>
  <span class="na">nginx</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">nginx:latest</span>
    <span class="na">container_name</span><span class="pi">:</span> <span class="s">nginx</span>
    <span class="na">restart</span><span class="pi">:</span> <span class="s">unless-stopped</span>
    <span class="na">networks</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">traefik_default</span>
    <span class="c1"># ports:</span>
    <span class="c1">#   - "80:80"</span>
    <span class="na">labels</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">traefik.enable=true"</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">traefik.http.routers.nginx.entrypoints=websecure"</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">traefik.http.routers.nginx.rule=Host(`nginx.example.com`)"</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">traefik.http.routers.nginx.tls=true"</span>
      <span class="c1"># - "traefik.http.routers.nginx.tls.certresolver=production" # use this if you want to use LetsEncrypt SSL certificates</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">traefik.http.services.nginx.loadbalancer.server.port=80"</span>

<span class="na">networks</span><span class="pi">:</span>
  <span class="na">traefik_default</span><span class="pi">:</span>
    <span class="na">external</span><span class="pi">:</span> <span class="no">true</span>
</pre></table></code></div></div><p>Things to remember while creating docker-compose.yml file for a container which uses traefik.</p><ul><li><p><code class="language-plaintext highlighter-rouge">traefik.enable=true</code>: This is required to enable traefik to know which container wants to use traefik.</p><li><p><code class="language-plaintext highlighter-rouge">traefik.http.routers.nginx.entrypoints=websecure</code>: This is required to enable traefik to watch https (:443) port as entrypoint for this service.</p><li><p><code class="language-plaintext highlighter-rouge">traefik.http.routers.nginx.rule=Host(</code>nginx.example.com<code class="language-plaintext highlighter-rouge">)</code>: This is required to enable traefik to watch nginx.example.com as hostname for this service.</p><li><p><code class="language-plaintext highlighter-rouge">traefik.http.routers.nginx.tls=true</code>: This is required to enable traefik to use SSL.</p><li><p><code class="language-plaintext highlighter-rouge">traefik.http.routers.nginx.tls.certresolver=production</code>: This is required to enable traefik to use LetsEncrypt SSL certificates. (staging or production)</p><li><p><code class="language-plaintext highlighter-rouge">traefik.http.services.nginx.loadbalancer.server.port=80</code>: This is required to enable traefik to send traffic to this docker container at port 80.</p></ul><p>This is the format traeffic uses to send traffic to your container.</p><p><img data-src="/assets/traefik_map.png" alt="traefik map" data-proofer-ignore></p><p>If you want to add a middleware like authelia for authentication before accessing the service then you can add it as a label to the nginx docker-compose.yml file as shown below.</p><div class="language-yaml highlighter-rouge"><div class="code-header"> <span data-label-text="YAML"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="pi">-</span> <span class="s2">"</span><span class="s">traefik.http.routers.nginx.middlewares=authelia@docker"</span>
</pre></table></code></div></div><p>Now the traefik map will look like this.</p><p><img data-src="/assets/traefik_map_with_middleware.png" alt="traefik_map_with_middleware" data-proofer-ignore></p><h1 id="connect-services-running-on-host-machine-from-reverse-proxy-running-in-docker-container">Connect services running on host machine from reverse proxy running in docker container</h1><ul><li><p>First check the port is open on the host machine. You can use the following command to check if port is accepting connections. (If a service is in docker container, <strong>docker</strong> will <em>automatically</em> add rules to <em>iptables</em> to allow connections to the port)</p><ul><li><p><u>Using iptables</u></p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nb">sudo </span>iptables <span class="nt">-S</span> | <span class="nb">grep</span> &lt;PORT_NUMBER&gt;
</pre></table></code></div></div><ul><li>If port is not shown in the list or it is showing <strong>REJECT</strong> then you can use the following command to open the port.</ul><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nb">sudo </span>iptables <span class="nt">-I</span> INPUT 6 <span class="nt">-m</span> state <span class="nt">--state</span> NEW <span class="nt">-p</span> tcp <span class="nt">--dport</span> &lt;PORT_NUMBER&gt; <span class="nt">-j</span> ACCEPT
</pre></table></code></div></div><ul><li>This iptables change will not persist after <strong>restart</strong>. So you can use the following command to save the changes.</ul><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nb">sudo </span>netfilter-persistent save
</pre></table></code></div></div><li><p><u>Using ufw firewall</u></p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nb">sudo </span>ufw status
</pre></table></code></div></div><ul><li>If port is not shown in the list or it is showing <strong>deny</strong> then you can use the following command to open the port.</ul><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nb">sudo </span>ufw allow &lt;PORT_NUMBER&gt;
</pre></table></code></div></div></ul><li><p>Add an <em>environment variable</em> to your docker-compose.yml file.</p><div class="language-yaml highlighter-rouge"><div class="code-header"> <span data-label-text="YAML"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="na">extra_hosts</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="s">host.docker.internal:$HOST_GATEWAY</span>
</pre></table></code></div></div><li><p>Adding the following in <strong>script.sh</strong> file.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="c">#!/bin/bash</span>

<span class="nb">export </span><span class="nv">HOST_GATEWAY</span><span class="o">=</span><span class="si">$(</span>ip <span class="nt">-4</span> addr show docker0 | <span class="nb">grep</span> <span class="nt">-Po</span> <span class="s1">'inet \K[\d.]+'</span><span class="si">)</span>
<span class="c"># docker compose up -d --force-recreate</span>
</pre></table></code></div></div><li><p>Run the script.sh using the following command.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nb">source</span> ./script.sh
</pre></table></code></div></div><li><p>Now you can access the service on your host machine from the docker container using <strong>host.docker.internal</strong> instead of <strong>localhost</strong>.</p></ul></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/homelab/'>homelab</a>, <a href='/categories/domain/'>domain</a>, <a href='/categories/cloudflare/'>cloudflare</a>, <a href='/categories/services/'>services</a>, <a href='/categories/internet/'>internet</a>, <a href='/categories/traefik/'>traefik</a>, <a href='/categories/nginx/'>nginx</a>, <a href='/categories/letsencrypt/'>letsencrypt</a>, <a href='/categories/tunnel/'>tunnel</a>, <a href='/categories/ssl/'>ssl</a>, <a href='/categories/tls/'>tls</a>, <a href='/categories/email/'>email</a>, <a href='/categories/forward/'>forward</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/homelab/" class="post-tag no-text-decoration" >homelab</a> <a href="/tags/domain/" class="post-tag no-text-decoration" >domain</a> <a href="/tags/cloudflare/" class="post-tag no-text-decoration" >cloudflare</a> <a href="/tags/services/" class="post-tag no-text-decoration" >services</a> <a href="/tags/internet/" class="post-tag no-text-decoration" >internet</a> <a href="/tags/traefik/" class="post-tag no-text-decoration" >traefik</a> <a href="/tags/nginx/" class="post-tag no-text-decoration" >nginx</a> <a href="/tags/letsencrypt/" class="post-tag no-text-decoration" >letsencrypt</a> <a href="/tags/tunnel/" class="post-tag no-text-decoration" >tunnel</a> <a href="/tags/ssl/" class="post-tag no-text-decoration" >ssl</a> <a href="/tags/tls/" class="post-tag no-text-decoration" >tls</a> <a href="/tags/email/" class="post-tag no-text-decoration" >email</a> <a href="/tags/forward/" class="post-tag no-text-decoration" >forward</a> <a href="/tags/caddy/" class="post-tag no-text-decoration" >caddy</a> <a href="/tags/reverse/" class="post-tag no-text-decoration" >reverse</a> <a href="/tags/proxy/" class="post-tag no-text-decoration" >proxy</a> <a href="/tags/connect/" class="post-tag no-text-decoration" >connect</a> <a href="/tags/cloudflared-tunnel/" class="post-tag no-text-decoration" >cloudflared-tunnel</a> <a href="/tags/tunnel/" class="post-tag no-text-decoration" >tunnel</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Connecting services to internet using reverse proxy - HomeLab Docs&amp;url=https://docs.divyanshchauhan.com/posts/connect-services-to-internet/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Connecting services to internet using reverse proxy - HomeLab Docs&amp;u=https://docs.divyanshchauhan.com/posts/connect-services-to-internet/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https://docs.divyanshchauhan.com/posts/connect-services-to-internet/&amp;text=Connecting services to internet using reverse proxy - HomeLab Docs" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/basic-security-measures-services/">Enhancing security on services using crowdsec, watchtower, authelia, traefik</a><li><a href="/posts/ssh-using-teleport/">Access servers securely using teleport, tailscale, cloudflare</a><li><a href="/posts/adding-authentication-to-services/">Adding authentication to services using authelia, traefik</a><li><a href="/posts/connect-services-to-internet/">Connecting services to internet using reverse proxy</a><li><a href="/posts/basics-of-setup-domain/">Setting up your new domain</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/homelab/">homelab</a> <a class="post-tag" href="/tags/cloudflare/">cloudflare</a> <a class="post-tag" href="/tags/domain/">domain</a> <a class="post-tag" href="/tags/traefik/">traefik</a> <a class="post-tag" href="/tags/caddy/">caddy</a> <a class="post-tag" href="/tags/sso/">sso</a> <a class="post-tag" href="/tags/totp/">totp</a> <a class="post-tag" href="/tags/authelia/">authelia</a> <a class="post-tag" href="/tags/security/">security</a> <a class="post-tag" href="/tags/servers/">servers</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="tail-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/using-tailscale-to-access-services/"><div class="card-body"> <em class="timeago small" data-ts="1655445240" > 2022-06-17 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Using tailscale to access services privately on your personal VPN mesh network using SSL</h3><div class="text-muted small"><p> Tailscale Setup tailscale Install tailscale using this guide. Check if tailscale is running as a service. 1 sudo systemctl status tailscale If not running, s...</p></div></div></a></div><div class="card"> <a href="/posts/adding-authentication-to-services/"><div class="card-body"> <em class="timeago small" data-ts="1655376480" > 2022-06-16 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Adding authentication to services using authelia, traefik</h3><div class="text-muted small"><p> Adding Single Sign On and 2 Factor Auth (TOTP) using Authelia middleware for traefik Traefik You can check this section on how to install traefik. Authelia Add a DNS record for auth...</p></div></div></a></div><div class="card"> <a href="/posts/basic-security-measures-services/"><div class="card-body"> <em class="timeago small" data-ts="1655544780" > 2022-06-18 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Enhancing security on services using crowdsec, watchtower, authelia, traefik</h3><div class="text-muted small"><p> Cloudflare Choose cloudflare proxy whenever you are pointing a domain to a service. It will show the IP of cloudflare proxy instead of our server. Ports Only open ports that are required ...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/basics-of-setup-domain/" class="btn btn-outline-primary" prompt="Older"><p>Setting up your new domain</p></a> <a href="/posts/adding-authentication-to-services/" class="btn btn-outline-primary" prompt="Newer"><p>Adding authentication to services using authelia, traefik</p></a></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center text-muted"><div class="footer-left"><p class="mb-0"> © 2022 <a href="https://github.com/divyanshc">Divyansh Chauhan</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/homelab/">homelab</a> <a class="post-tag" href="/tags/cloudflare/">cloudflare</a> <a class="post-tag" href="/tags/domain/">domain</a> <a class="post-tag" href="/tags/traefik/">traefik</a> <a class="post-tag" href="/tags/caddy/">caddy</a> <a class="post-tag" href="/tags/sso/">sso</a> <a class="post-tag" href="/tags/totp/">totp</a> <a class="post-tag" href="/tags/authelia/">authelia</a> <a class="post-tag" href="/tags/security/">security</a> <a class="post-tag" href="/tags/servers/">servers</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/en.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-DKH7JQZ49F"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-DKH7JQZ49F'); }); </script>
